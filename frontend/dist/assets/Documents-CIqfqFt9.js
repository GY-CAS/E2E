import{d as Y,F as H,H as u,b as t,a as o,w as n,I as w,J as j,v as c,K as U,L as m,a6 as q,e as A,a7 as K,D as P,o as d,c as z,x as J,u as p,S as O,r as h,j as R,T as Z,a8 as G,Z as Q,a9 as W,a2 as X,aa as ee,a3 as f,a5 as ae}from"./index-CILAngGp.js";/* empty css                    *//* empty css                  *//* empty css                  */import{p as te,d as v}from"./index-BIy6QEMb.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"documents-page"},le={class:"page-header"},ne={class:"header-actions"},ce={class:"content-card"},de={class:"documents-list"},re={class:"doc-icon"},ie={class:"doc-info"},ue={class:"doc-name"},pe={class:"doc-meta"},_e={class:"meta-tag"},me={class:"meta-size"},fe={class:"meta-date"},ve={class:"doc-actions"},ye={key:0,class:"empty-state"},ge=Y({__name:"Documents",setup(he){const x=P(),y=m(!1),_=m([]),b=m([]),l=m(""),D={requirement:"需求文档",spec:"规格说明书",design:"设计文档",api:"接口说明",manual:"用户手册",image:"图片"},k={pending:"待解析",processing:"解析中",parsed:"已解析",failed:"解析失败"},F=e=>D[e]||e||"文档",B=e=>k[e]||e,C=e=>X(e).format("YYYY-MM-DD HH:mm"),E=e=>e?e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/1024/1024).toFixed(1)} MB`:"-",V=async()=>{try{b.value=await te.list();const e=x.query.project_id;e&&(l.value=e)}catch(e){console.error("Failed to load projects:",e)}},r=async()=>{if(!l.value){_.value=[];return}y.value=!0;try{_.value=await v.list({project_id:l.value})}catch(e){console.error("Failed to load documents:",e)}finally{y.value=!1}},L=async e=>{if(!l.value)return f.warning("请先选择项目"),!1;try{await v.upload(l.value,e),f.success("上传成功"),r()}catch(a){console.error("Failed to upload:",a)}return!1},M=async e=>{try{await v.parse(e.id),f.success("开始解析文档"),r()}catch(a){console.error("Failed to parse:",a)}},S=async e=>{try{await ae.confirm("确定要删除该文档吗？","提示",{type:"warning"}),await v.delete(e.id),f.success("删除成功"),r()}catch(a){a!=="cancel"&&console.error("Failed to delete:",a)}};return H(async()=>{await V(),await r()}),(e,a)=>{const $=ee,I=q,i=A,g=J,N=K;return d(),u("div",oe,[t("div",le,[a[2]||(a[2]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"文档管理"),t("p",{class:"page-subtitle"},"上传和管理项目文档")],-1)),t("div",ne,[o(I,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value=s),placeholder:"选择项目",class:"project-select",clearable:"",onChange:r},{default:n(()=>[(d(!0),u(w,null,j(b.value,s=>(d(),z($,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(N,{"show-file-list":!1,"before-upload":L,disabled:!l.value},{default:n(()=>[o(g,{type:"primary",class:"upload-btn",disabled:!l.value},{default:n(()=>[o(i,null,{default:n(()=>[o(p(O))]),_:1}),a[1]||(a[1]=h(" 上传文档 ",-1))]),_:1},8,["disabled"])]),_:1},8,["disabled"])])]),t("div",ce,[t("div",de,[(d(!0),u(w,null,j(_.value,s=>(d(),u("div",{key:s.id,class:"document-item"},[t("div",re,[o(i,null,{default:n(()=>[o(p(R))]),_:1})]),t("div",ie,[t("div",ue,c(s.name),1),t("div",pe,[t("span",_e,c(F(s.doc_type)),1),t("span",me,c(E(s.file_size)),1),t("span",fe,c(C(s.created_at)),1)])]),t("div",{class:Z(["doc-status",s.status])},c(B(s.status)),3),t("div",ve,[o(g,{type:"primary",text:"",size:"small",onClick:T=>M(s),disabled:s.status!=="pending"},{default:n(()=>[o(i,null,{default:n(()=>[o(p(G))]),_:1}),a[3]||(a[3]=h(" 解析 ",-1))]),_:1},8,["onClick","disabled"]),o(g,{type:"danger",text:"",size:"small",onClick:T=>S(s)},{default:n(()=>[o(i,null,{default:n(()=>[o(p(Q))]),_:1}),a[4]||(a[4]=h(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128)),!y.value&&_.value.length===0?(d(),u("div",ye,[o(i,null,{default:n(()=>[o(p(W))]),_:1}),t("p",null,c(l.value?"暂无文档":"请先选择项目"),1)])):U("",!0)])])])}}}),Fe=se(ge,[["__scopeId","data-v-64d41433"]]);export{Fe as default};
