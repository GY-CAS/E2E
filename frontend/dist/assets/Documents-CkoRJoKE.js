import{d as Y,o as T,K as u,e as t,b as o,w as n,L as w,M as k,y as c,N as q,r as m,a8 as z,f as A,a9 as H,I as K,a as d,c as P,z as O,u as p,U as R,x as h,k as G,V as J,aa as Q,$ as W,ab as X,a4 as Z,ac as ee,a5 as f,a7 as ae}from"./index-DK81lzkh.js";/* empty css                    *//* empty css                  *//* empty css                  */import{p as te,d as v}from"./index-BL4ylxUb.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"documents-page"},le={class:"page-header"},ne={class:"header-actions"},ce={class:"content-card"},de={class:"documents-list"},re={class:"doc-icon"},ie={class:"doc-info"},ue={class:"doc-name"},pe={class:"doc-meta"},_e={class:"meta-tag"},me={class:"meta-size"},fe={class:"meta-date"},ve={class:"doc-actions"},ye={key:0,class:"empty-state"},ge=Y({__name:"Documents",setup(he){const x=K(),y=m(!1),_=m([]),b=m([]),l=m(""),j={requirement:"需求文档",spec:"规格说明书",design:"设计文档",api:"接口说明",manual:"用户手册",image:"图片"},D={pending:"待解析",processing:"解析中",parsed:"已解析",failed:"解析失败"},B=e=>j[e]||e||"文档",C=e=>D[e]||e,F=e=>Z(e).format("YYYY-MM-DD HH:mm"),E=e=>e?e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/1024/1024).toFixed(1)} MB`:"-",V=async()=>{try{b.value=await te.list();const e=x.query.project_id;e&&(l.value=e)}catch(e){console.error("Failed to load projects:",e)}},r=async()=>{if(!l.value){_.value=[];return}y.value=!0;try{_.value=await v.list({project_id:l.value})}catch(e){console.error("Failed to load documents:",e)}finally{y.value=!1}},M=async e=>{if(!l.value)return f.warning("请先选择项目"),!1;try{await v.upload(l.value,e),f.success("上传成功"),r()}catch(a){console.error("Failed to upload:",a)}return!1},L=async e=>{try{await v.parse(e.id),f.success("开始解析文档"),r()}catch(a){console.error("Failed to parse:",a)}},$=async e=>{try{await ae.confirm("确定要删除该文档吗？","提示",{type:"warning"}),await v.delete(e.id),f.success("删除成功"),r()}catch(a){a!=="cancel"&&console.error("Failed to delete:",a)}};return T(async()=>{await V(),await r()}),(e,a)=>{const N=ee,I=z,i=A,g=O,S=H;return d(),u("div",oe,[t("div",le,[a[2]||(a[2]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"文档管理"),t("p",{class:"page-subtitle"},"上传和管理项目文档")],-1)),t("div",ne,[o(I,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value=s),placeholder:"选择项目",class:"project-select",clearable:"",onChange:r},{default:n(()=>[(d(!0),u(w,null,k(b.value,s=>(d(),P(N,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(S,{"show-file-list":!1,"before-upload":M,disabled:!l.value},{default:n(()=>[o(g,{type:"primary",class:"upload-btn",disabled:!l.value},{default:n(()=>[o(i,null,{default:n(()=>[o(p(R))]),_:1}),a[1]||(a[1]=h(" 上传文档 ",-1))]),_:1},8,["disabled"])]),_:1},8,["disabled"])])]),t("div",ce,[t("div",de,[(d(!0),u(w,null,k(_.value,s=>(d(),u("div",{key:s.id,class:"document-item"},[t("div",re,[o(i,null,{default:n(()=>[o(p(G))]),_:1})]),t("div",ie,[t("div",ue,c(s.name),1),t("div",pe,[t("span",_e,c(B(s.doc_type)),1),t("span",me,c(E(s.file_size)),1),t("span",fe,c(F(s.created_at)),1)])]),t("div",{class:J(["doc-status",s.status])},c(C(s.status)),3),t("div",ve,[o(g,{type:"primary",text:"",size:"small",onClick:U=>L(s),disabled:s.status!=="pending"},{default:n(()=>[o(i,null,{default:n(()=>[o(p(Q))]),_:1}),a[3]||(a[3]=h(" 解析 ",-1))]),_:1},8,["onClick","disabled"]),o(g,{type:"danger",text:"",size:"small",onClick:U=>$(s)},{default:n(()=>[o(i,null,{default:n(()=>[o(p(W))]),_:1}),a[4]||(a[4]=h(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128)),!y.value&&_.value.length===0?(d(),u("div",ye,[o(i,null,{default:n(()=>[o(p(X))]),_:1}),t("p",null,c(l.value?"暂无文档":"请先选择项目"),1)])):q("",!0)])])])}}}),Be=se(ge,[["__scopeId","data-v-172bf9e4"]]);export{Be as default};
