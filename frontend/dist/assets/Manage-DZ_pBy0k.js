import{d as ct,o as vt,K as p,e,af as _t,b as l,w as n,y as r,N as b,L as F,M as L,c as C,r as v,a8 as mt,z as yt,X as wt,a as i,x as c,V as T,ag as gt,ah as ft,a0 as ht,a1 as bt,a2 as xt,ai as kt,aj as Vt,ac as Ct,ak as Mt,a3 as Bt,a5 as M,a7 as Et,al as jt,am as Ut}from"./index-DK81lzkh.js";/* empty css                 *//* empty css                             *//* empty css                   *//* empty css                  */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{p as Tt,t as B}from"./index-BL4ylxUb.js";import{_ as Ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Lt={class:"test-cases-page"},$t={class:"page-header"},Dt={class:"header-actions"},Pt={class:"project-selector"},St={key:0,class:"stats-bar"},zt={class:"stat-item"},It={class:"stat-info"},Nt={class:"stat-value"},Ht={class:"stat-item"},At={class:"stat-info"},qt={class:"stat-value"},Rt={class:"stat-item"},Kt={class:"stat-info"},Ot={class:"stat-value"},Xt={class:"content-card"},Gt={key:0,class:"tc-list"},Jt={class:"tc-header"},Qt={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Wt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Yt={key:2,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Zt={key:3,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},te={class:"tc-title-area"},ee={class:"tc-name"},se={class:"tc-meta"},le={class:"tc-footer"},oe={key:0,class:"tc-desc"},ae={key:1,class:"tc-desc",style:{opacity:"0.5"}},ne={class:"tc-actions"},ie=["onClick"],re=["onClick"],de=["onClick","disabled"],pe=["onClick","disabled"],ue=["onClick"],ce={key:1,class:"empty-state"},ve={key:0,class:"detail-content"},_e={class:"detail-header"},me={class:"detail-title"},ye={class:"detail-tags"},we={key:0,class:"detail-section"},ge={class:"steps-container"},fe={class:"step-number"},he={class:"step-info"},be={class:"step-action"},xe={class:"step-expected"},ke={key:1,class:"detail-section"},Ve={class:"result-content"},Ce={class:"steps-form"},Me={class:"step-form-header"},Be=ct({__name:"Manage",setup(Ee){const I=v(!1),$=v(!1),x=v([]),N=v([]),_=v(""),D=v(!1),d=v(null),V=v(!1),E=v(!1),P=v(),S=v(""),o=Bt({title:"",description:"",test_type:"functional",test_category:"functional",priority:"p2",preconditions:"",test_steps:[],expected_results:""}),O={title:[{required:!0,message:"请输入用例标题",trigger:"blur"}],test_type:[{required:!0,message:"请选择测试类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}]},X={functional:"功能测试",performance:"性能测试",security:"安全测试",reliability:"可靠性测试"},G={draft:"草稿",reviewed:"已审核",approved:"已通过",rejected:"已拒绝"},H=a=>X[a]||a,A=a=>G[a]||a,J=a=>({functional:"",performance:"warning",security:"danger",reliability:"success"})[a]||"info",Q=a=>({p0:"danger",p1:"danger",p2:"warning",p3:"info",p4:"info"})[a]||"info",W=a=>({draft:"info",reviewed:"warning",approved:"success",rejected:"danger"})[a]||"info",Y=async()=>{try{N.value=await Tt.list()}catch(a){console.error("Failed to load projects:",a)}},j=async()=>{if(!_.value){x.value=[];return}I.value=!0;try{x.value=await B.list({project_id:_.value})}catch(a){console.error("Failed to load test cases:",a)}finally{I.value=!1}},Z=()=>{o.title="",o.description="",o.test_type="functional",o.test_category="functional",o.priority="p2",o.preconditions="",o.test_steps=[{step_num:1,action:"",expected_result:""}],o.expected_results="",S.value="",E.value=!1},q=()=>{Z(),V.value=!0},tt=a=>{E.value=!0,S.value=a.id,o.title=a.title,o.description=a.description||"",o.test_type=a.test_type||"functional",o.test_category=a.test_category||"functional",o.priority=a.priority||"p2",o.preconditions=a.preconditions||"",o.test_steps=a.test_steps&&a.test_steps.length>0?a.test_steps.map((t,u)=>({step_num:u+1,action:t.action,expected_result:t.expected_result})):[{step_num:1,action:"",expected_result:""}],o.expected_results=a.expected_results||"",V.value=!0},et=()=>{o.test_steps.push({step_num:o.test_steps.length+1,action:"",expected_result:""})},st=a=>{o.test_steps.splice(a,1),o.test_steps.forEach((t,u)=>{t.step_num=u+1})},lt=async()=>{P.value&&await P.value.validate(async a=>{var t,u;if(a){$.value=!0;try{const m=o.test_steps.filter(y=>y.action.trim()).map((y,U)=>({step_num:U+1,action:y.action,expected_result:y.expected_result})),w={title:o.title,description:o.description,test_type:o.test_type,test_category:o.test_category,priority:o.priority,preconditions:o.preconditions,test_steps:m,expected_results:o.expected_results,project_id:_.value,status:E.value?"draft":void 0};E.value?(await B.update(S.value,w),M.success("更新成功，状态已重置为待审核")):(await B.create(w),M.success("创建成功")),V.value=!1,j()}catch(m){console.error("Failed to save:",m),M.error(((u=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:u.detail)||"保存失败")}finally{$.value=!1}}})},ot=a=>{d.value=a,D.value=!0},at=async a=>{try{await B.approve(a.id),M.success("审核通过"),j()}catch(t){console.error("Failed to approve:",t)}},nt=async a=>{try{await B.reject(a.id),M.success("已拒绝"),j()}catch(t){console.error("Failed to reject:",t)}},it=async a=>{try{await Et.confirm(`确定要删除测试用例「${a.title}」吗？`,"删除确认",{type:"warning"}),await B.delete(a.id),M.success("删除成功"),j()}catch(t){t!=="cancel"&&console.error("Failed to delete:",t)}};return vt(async()=>{await Y()}),(a,t)=>{const u=Ct,m=mt,w=yt,y=jt,U=gt,z=Ut,rt=ft,R=wt,k=xt,g=bt,K=Vt,dt=kt,pt=Mt,ut=ht;return i(),p("div",Lt,[e("div",$t,[t[13]||(t[13]=_t('<div class="header-content" data-v-4b1a2016><div class="title-row" data-v-4b1a2016><div class="title-icon" data-v-4b1a2016><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-4b1a2016><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" data-v-4b1a2016></path></svg></div><div data-v-4b1a2016><h1 class="page-title" data-v-4b1a2016>测试用例管理</h1><p class="page-subtitle" data-v-4b1a2016>高效管理项目测试用例，保障产品质量</p></div></div></div>',1)),e("div",Dt,[e("div",Pt,[t[11]||(t[11]=e("label",null,"当前项目",-1)),l(m,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),placeholder:"选择项目",class:"project-select",clearable:"",onChange:j},{default:n(()=>[(i(!0),p(F,null,L(N.value,s=>(i(),C(u,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l(w,{type:"primary",class:"create-btn",onClick:q,disabled:!_.value},{default:n(()=>[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"btn-icon"},[e("path",{d:"M12 5v14M5 12h14"})],-1),c(" 新增用例 ",-1)])]),_:1},8,["disabled"])])]),_.value?(i(),p("div",St,[e("div",zt,[t[15]||(t[15]=e("div",{class:"stat-icon total"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1)),e("div",It,[e("span",Nt,r(x.value.length),1),t[14]||(t[14]=e("span",{class:"stat-label"},"总用例",-1))])]),e("div",Ht,[t[17]||(t[17]=e("div",{class:"stat-icon approved"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14M22 4L12 14.01l-3-3"})])],-1)),e("div",At,[e("span",qt,r(x.value.filter(s=>s.status==="approved").length),1),t[16]||(t[16]=e("span",{class:"stat-label"},"已通过",-1))])]),e("div",Rt,[t[19]||(t[19]=e("div",{class:"stat-icon pending"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 6v6l4 2"})])],-1)),e("div",Kt,[e("span",Ot,r(x.value.filter(s=>s.status==="draft").length),1),t[18]||(t[18]=e("span",{class:"stat-label"},"待审核",-1))])])])):b("",!0),e("div",Xt,[x.value.length>0?(i(),p("div",Gt,[(i(!0),p(F,null,L(x.value,s=>{var f;return i(),p("div",{key:s.id,class:T(["tc-item",`priority-${s.priority}`])},[e("div",Jt,[e("div",{class:T(["tc-icon",s.test_type])},[s.test_type==="functional"?(i(),p("svg",Qt,[...t[20]||(t[20]=[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"},null,-1),e("path",{d:"M9 9h6M9 13h6M9 17h4"},null,-1)])])):s.test_type==="performance"?(i(),p("svg",Wt,[...t[21]||(t[21]=[e("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"},null,-1)])])):s.test_type==="security"?(i(),p("svg",Yt,[...t[22]||(t[22]=[e("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"},null,-1)])])):(i(),p("svg",Zt,[...t[23]||(t[23]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{d:"M12 16v-4M12 8h.01"},null,-1)])]))],2),e("div",te,[e("div",ee,r(s.title),1),e("div",se,[e("span",{class:T(["meta-tag type-tag",s.test_type])},r(H(s.test_type)),3),e("span",{class:T(["meta-tag priority-tag",s.priority])},r((f=s.priority)==null?void 0:f.toUpperCase()),3)])]),e("div",{class:T(["tc-status-badge",s.status])},[t[24]||(t[24]=e("span",{class:"status-dot"},null,-1)),c(" "+r(A(s.status)),1)],2)]),e("div",le,[s.description?(i(),p("div",oe,r(s.description),1)):(i(),p("div",ae,"暂无描述")),e("div",ne,[l(y,{content:"查看详情",placement:"top"},{default:n(()=>[e("button",{class:"action-btn view",onClick:h=>ot(s)},[...t[25]||(t[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])],8,ie)]),_:2},1024),l(y,{content:"编辑",placement:"top"},{default:n(()=>[e("button",{class:"action-btn edit",onClick:h=>tt(s)},[...t[26]||(t[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,re)]),_:2},1024),l(y,{content:"通过审核",placement:"top"},{default:n(()=>[e("button",{class:"action-btn approve",onClick:h=>at(s),disabled:s.status==="approved"},[...t[27]||(t[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"20 6 9 17 4 12"})],-1)])],8,de)]),_:2},1024),l(y,{content:"拒绝",placement:"top"},{default:n(()=>[e("button",{class:"action-btn reject",onClick:h=>nt(s),disabled:s.status==="approved"||s.status==="rejected"},[...t[28]||(t[28]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,pe)]),_:2},1024),l(y,{content:"删除",placement:"top"},{default:n(()=>[e("button",{class:"action-btn delete",onClick:h=>it(s)},[...t[29]||(t[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,ue)]),_:2},1024)])])],2)}),128))])):(i(),p("div",ce,[t[31]||(t[31]=e("div",{class:"empty-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1)),e("h3",null,r(_.value?"暂无测试用例":"请先选择项目"),1),e("p",null,r(_.value?"点击右上角「新增用例」按钮创建第一个测试用例":"从下拉菜单中选择一个项目开始管理测试用例"),1),_.value?(i(),C(w,{key:0,type:"primary",class:"empty-btn",onClick:q},{default:n(()=>[...t[30]||(t[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"btn-icon"},[e("path",{d:"M12 5v14M5 12h14"})],-1),c(" 创建测试用例 ",-1)])]),_:1})):b("",!0)]))]),l(R,{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=s=>D.value=s),title:"测试用例详情",width:"700px"},{default:n(()=>[d.value?(i(),p("div",ve,[e("div",_e,[e("h3",me,r(d.value.title),1),e("div",ye,[l(U,{type:J(d.value.test_type)},{default:n(()=>[c(r(H(d.value.test_type)),1)]),_:1},8,["type"]),l(U,{type:Q(d.value.priority)},{default:n(()=>{var s;return[c(r((s=d.value.priority)==null?void 0:s.toUpperCase()),1)]}),_:1},8,["type"]),l(U,{type:W(d.value.status)},{default:n(()=>[c(r(A(d.value.status)),1)]),_:1},8,["type"])])]),l(rt,{column:1,border:"",class:"detail-desc"},{default:n(()=>[d.value.description?(i(),C(z,{key:0,label:"描述"},{default:n(()=>[c(r(d.value.description),1)]),_:1})):b("",!0),d.value.test_category?(i(),C(z,{key:1,label:"分类"},{default:n(()=>[c(r(d.value.test_category),1)]),_:1})):b("",!0),d.value.preconditions?(i(),C(z,{key:2,label:"前置条件"},{default:n(()=>[c(r(d.value.preconditions),1)]),_:1})):b("",!0)]),_:1}),d.value.test_steps&&d.value.test_steps.length>0?(i(),p("div",we,[t[34]||(t[34]=e("h4",null,"测试步骤",-1)),e("div",ge,[(i(!0),p(F,null,L(d.value.test_steps,(s,f)=>(i(),p("div",{key:f,class:"step-row"},[e("div",fe,r(f+1),1),e("div",he,[e("div",be,[t[32]||(t[32]=e("strong",null,"操作：",-1)),c(r(s.action),1)]),e("div",xe,[t[33]||(t[33]=e("strong",null,"预期：",-1)),c(r(s.expected_result),1)])])]))),128))])])):b("",!0),d.value.expected_results?(i(),p("div",ke,[t[35]||(t[35]=e("h4",null,"预期结果",-1)),e("p",Ve,r(d.value.expected_results),1)])):b("",!0)])):b("",!0)]),_:1},8,["modelValue"]),l(R,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=s=>V.value=s),title:E.value?"编辑测试用例":"新增测试用例",width:"650px"},{footer:n(()=>[l(w,{onClick:t[9]||(t[9]=s=>V.value=!1)},{default:n(()=>[...t[39]||(t[39]=[c("取消",-1)])]),_:1}),l(w,{type:"primary",onClick:lt,loading:$.value},{default:n(()=>[...t[40]||(t[40]=[c("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[l(ut,{model:o,rules:O,ref_key:"formRef",ref:P,"label-width":"100px"},{default:n(()=>[l(g,{label:"用例标题",prop:"title"},{default:n(()=>[l(k,{modelValue:o.title,"onUpdate:modelValue":t[2]||(t[2]=s=>o.title=s),placeholder:"请输入测试用例标题"},null,8,["modelValue"])]),_:1}),l(dt,{gutter:16},{default:n(()=>[l(K,{span:12},{default:n(()=>[l(g,{label:"测试类型",prop:"test_type"},{default:n(()=>[l(m,{modelValue:o.test_type,"onUpdate:modelValue":t[3]||(t[3]=s=>o.test_type=s),placeholder:"请选择类型",style:{width:"100%"}},{default:n(()=>[l(u,{label:"功能测试",value:"functional"}),l(u,{label:"性能测试",value:"performance"}),l(u,{label:"安全测试",value:"security"}),l(u,{label:"可靠性测试",value:"reliability"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(K,{span:12},{default:n(()=>[l(g,{label:"优先级",prop:"priority"},{default:n(()=>[l(m,{modelValue:o.priority,"onUpdate:modelValue":t[4]||(t[4]=s=>o.priority=s),placeholder:"请选择优先级",style:{width:"100%"}},{default:n(()=>[l(u,{label:"P0 - 最高",value:"p0"}),l(u,{label:"P1 - 高",value:"p1"}),l(u,{label:"P2 - 中",value:"p2"}),l(u,{label:"P3 - 低",value:"p3"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(g,{label:"用例描述",prop:"description"},{default:n(()=>[l(k,{modelValue:o.description,"onUpdate:modelValue":t[5]||(t[5]=s=>o.description=s),type:"textarea",rows:2,placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1}),l(g,{label:"测试分类",prop:"test_category"},{default:n(()=>[l(k,{modelValue:o.test_category,"onUpdate:modelValue":t[6]||(t[6]=s=>o.test_category=s),placeholder:"如：前端UI、后端API、业务流程等"},null,8,["modelValue"])]),_:1}),l(g,{label:"前置条件",prop:"preconditions"},{default:n(()=>[l(k,{modelValue:o.preconditions,"onUpdate:modelValue":t[7]||(t[7]=s=>o.preconditions=s),type:"textarea",rows:2,placeholder:"请输入前置条件"},null,8,["modelValue"])]),_:1}),l(pt,{"content-position":"left"},{default:n(()=>[...t[36]||(t[36]=[c("测试步骤",-1)])]),_:1}),e("div",Ce,[(i(!0),p(F,null,L(o.test_steps,(s,f)=>(i(),p("div",{key:f,class:"step-form-item"},[e("div",Me,[e("span",null,"步骤 "+r(f+1),1),o.test_steps.length>1?(i(),C(w,{key:0,type:"danger",text:"",size:"small",onClick:h=>st(f)},{default:n(()=>[...t[37]||(t[37]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])):b("",!0)]),l(g,{label:"操作"},{default:n(()=>[l(k,{modelValue:s.action,"onUpdate:modelValue":h=>s.action=h,type:"textarea",rows:2,placeholder:"请输入操作步骤"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(g,{label:"预期结果"},{default:n(()=>[l(k,{modelValue:s.expected_result,"onUpdate:modelValue":h=>s.expected_result=h,type:"textarea",rows:2,placeholder:"请输入预期结果"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]))),128)),l(w,{type:"primary",plain:"",onClick:et,class:"add-step-btn"},{default:n(()=>[...t[38]||(t[38]=[c(" + 添加步骤 ",-1)])]),_:1})]),l(g,{label:"预期结果",prop:"expected_results"},{default:n(()=>[l(k,{modelValue:o.expected_results,"onUpdate:modelValue":t[8]||(t[8]=s=>o.expected_results=s),type:"textarea",rows:3,placeholder:"请输入整体预期结果"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ze=Ft(Be,[["__scopeId","data-v-4b1a2016"]]);export{ze as default};
