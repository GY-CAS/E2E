import{d as L,o as q,K as _,e as l,b as t,w as s,L as A,M as K,N as j,r as d,F as W,f as X,z as Z,W as G,X as H,a as v,u as c,C as J,x as u,j as O,y,V as Q,Y as ee,Z as te,_ as ae,$ as se,S as oe,a0 as le,a1 as ne,a2 as ie,a3 as re,a4 as ue,a5 as P,a6 as de,a7 as ce}from"./index-DK81lzkh.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                  */import{p as g}from"./index-BL4ylxUb.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"projects-page"},fe={class:"page-header"},_e={class:"content-card"},ve={class:"projects-list"},ge={class:"project-icon"},ye={class:"project-info"},ke={class:"project-name"},we={class:"project-meta"},xe={class:"meta-date"},Ce={class:"project-desc"},Ve={class:"project-actions"},be={key:0,class:"empty-state"},je={key:0,class:"pagination-wrapper"},k=10,Pe=L({__name:"Projects",setup(Ee){const B=de(),w=d(!1),x=d(!1),m=d([]),p=d(!1),f=d(null),C=d(),V=d(1),i=re({name:"",description:""}),D={name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},M=a=>ue(a).format("YYYY-MM-DD"),h=W(()=>{const a=(V.value-1)*k,e=a+k;return m.value.slice(a,e)}),b=async()=>{w.value=!0;try{const a=await g.list({limit:100});m.value=a}catch(a){console.error("Failed to load projects:",a)}finally{w.value=!1}},E=()=>{f.value=null,i.name="",i.description="",p.value=!0},I=a=>{f.value=a,i.name=a.name,i.description=a.description||"",p.value=!0},N=a=>{B.push(`/documents?project_id=${a.id}`)},Y=async a=>{try{const e=await g.stats(a.id),n=[];e.document_count>0&&n.push(`${e.document_count} 个文档`),e.function_point_count>0&&n.push(`${e.function_point_count} 个功能点`),e.test_case_count>0&&n.push(`${e.test_case_count} 个测试用例`);let r="确定要删除该项目吗？";n.length>0&&(r=`该项目下有 ${n.join("、")}，删除后将无法恢复，确定要删除吗？`),await ce.confirm(r,"删除确认",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await g.delete(a.id),P.success("项目删除成功"),b()}catch(e){e!=="cancel"&&console.error("Failed to delete project:",e)}},U=async()=>{C.value&&await C.value.validate(async a=>{if(a){x.value=!0;try{f.value?(await g.update(f.value.id,i),P.success("更新成功")):(await g.create(i),P.success("创建成功")),p.value=!1,b()}catch(e){console.error("Failed to submit:",e)}finally{x.value=!1}}})};return q(()=>{b()}),(a,e)=>{const n=X,r=Z,R=G,$=ie,F=ne,S=le,T=H;return v(),_("div",me,[l("div",fe,[e[6]||(e[6]=l("div",{class:"header-content"},[l("h1",{class:"page-title"},"项目管理"),l("p",{class:"page-subtitle"},"管理所有测试项目")],-1)),t(r,{type:"primary",class:"create-btn",onClick:E},{default:s(()=>[t(n,null,{default:s(()=>[t(c(J))]),_:1}),e[5]||(e[5]=u(" 新建项目 ",-1))]),_:1})]),l("div",_e,[l("div",ve,[(v(!0),_(A,null,K(h.value,o=>(v(),_("div",{key:o.id,class:"project-item"},[l("div",ge,[t(n,null,{default:s(()=>[t(c(O))]),_:1})]),l("div",ye,[l("div",ke,y(o.name),1),l("div",we,[l("span",{class:Q(["meta-tag status-tag",o.status])},y(o.status==="active"?"活跃":"归档"),3),l("span",xe,[t(n,null,{default:s(()=>[t(c(ee))]),_:1}),u(" "+y(M(o.created_at)),1)])])]),l("div",Ce,y(o.description||"暂无描述"),1),l("div",Ve,[t(r,{type:"primary",text:"",size:"small",onClick:z=>N(o)},{default:s(()=>[t(n,null,{default:s(()=>[t(c(te))]),_:1}),e[7]||(e[7]=u(" 查看 ",-1))]),_:1},8,["onClick"]),j("",!0),t(r,{type:"warning",text:"",size:"small",onClick:z=>I(o)},{default:s(()=>[t(n,null,{default:s(()=>[t(c(ae))]),_:1}),e[9]||(e[9]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),t(r,{type:"danger",text:"",size:"small",onClick:z=>Y(o)},{default:s(()=>[t(n,null,{default:s(()=>[t(c(se))]),_:1}),e[10]||(e[10]=u(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128)),!w.value&&m.value.length===0?(v(),_("div",be,[t(n,null,{default:s(()=>[t(c(oe))]),_:1}),e[12]||(e[12]=l("p",null,"暂无项目",-1)),t(r,{type:"primary",onClick:E},{default:s(()=>[...e[11]||(e[11]=[u("创建第一个项目",-1)])]),_:1})])):j("",!0)]),m.value.length>k?(v(),_("div",je,[t(R,{"current-page":V.value,"onUpdate:currentPage":e[0]||(e[0]=o=>V.value=o),"page-size":k,total:m.value.length,layout:"total, prev, pager, next",background:""},null,8,["current-page","total"])])):j("",!0)]),t(T,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),title:f.value?"编辑项目":"新建项目",width:"500px",class:"dark-dialog"},{footer:s(()=>[t(r,{onClick:e[3]||(e[3]=o=>p.value=!1)},{default:s(()=>[...e[13]||(e[13]=[u("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:U,loading:x.value},{default:s(()=>[...e[14]||(e[14]=[u("确定",-1)])]),_:1},8,["loading"])]),default:s(()=>[t(S,{model:i,rules:D,ref_key:"formRef",ref:C,"label-width":"80px"},{default:s(()=>[t(F,{label:"项目名称",prop:"name"},{default:s(()=>[t($,{modelValue:i.name,"onUpdate:modelValue":e[1]||(e[1]=o=>i.name=o),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(F,{label:"描述",prop:"description"},{default:s(()=>[t($,{modelValue:i.description,"onUpdate:modelValue":e[2]||(e[2]=o=>i.description=o),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ie=pe(Pe,[["__scopeId","data-v-5e3621b7"]]);export{Ie as default};
