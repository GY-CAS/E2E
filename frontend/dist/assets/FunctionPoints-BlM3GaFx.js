import{d as Z,o as ee,K as g,e as n,b as e,w as s,L as B,M as L,y as b,N as D,r as d,a8 as te,f as ae,z as le,X as oe,a as m,c as se,u as _,C as ne,x as v,l as I,V as N,_ as ie,ad as re,ae as de,$ as ue,a0 as ce,a1 as pe,a2 as me,ac as _e,a3 as ve,a5 as V,a7 as fe}from"./index-DK81lzkh.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                  */import{p as ye,f as w}from"./index-BL4ylxUb.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"function-points-page"},Ve={class:"page-header"},we={class:"header-actions"},ke={class:"content-card"},Ce={class:"fp-list"},Fe={class:"fp-icon"},xe={class:"fp-info"},Pe={class:"fp-name"},Ee={class:"fp-meta"},je={class:"meta-tag type-tag"},he={key:0,class:"meta-module"},Ue={class:"fp-actions"},$e={key:0,class:"empty-state"},ze=Z({__name:"FunctionPoints",setup(Be){const P=d(!1),E=d(!1),F=d([]),$=d([]),u=d(""),f=d(!1),k=d(!1),j=d(),h=d(""),o=ve({name:"",description:"",test_type:"functional",priority:"p2",module:"",acceptance_criteria:""}),M={name:[{required:!0,message:"请输入功能点名称",trigger:"blur"}],test_type:[{required:!0,message:"请选择测试类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}]},T={functional:"功能测试",performance:"性能测试",security:"安全测试",reliability:"可靠性测试"},q={pending:"待审核",approved:"已通过",rejected:"已拒绝"},A=l=>T[l]||l,S=l=>q[l]||l,R=async()=>{try{$.value=await ye.list()}catch(l){console.error("Failed to load projects:",l)}},C=async()=>{if(!u.value){F.value=[];return}P.value=!0;try{F.value=await w.list({project_id:u.value})}catch(l){console.error("Failed to load function points:",l)}finally{P.value=!1}},K=()=>{o.name="",o.description="",o.test_type="functional",o.priority="p2",o.module="",o.acceptance_criteria="",h.value="",k.value=!1},O=()=>{K(),f.value=!0},X=l=>{k.value=!0,h.value=l.id,o.name=l.name,o.description=l.description||"",o.test_type=l.test_type||"functional",o.priority=l.priority||"p2",o.module=l.module||"",o.acceptance_criteria=l.acceptance_criteria||"",f.value=!0},G=async()=>{j.value&&await j.value.validate(async l=>{var t,i;if(l){E.value=!0;try{const r={...o,project_id:u.value,status:k.value?"pending":void 0};k.value?(await w.update(h.value,r),V.success("更新成功，状态已重置为待审核")):(await w.create(r),V.success("创建成功")),f.value=!1,C()}catch(r){console.error("Failed to save:",r),V.error(((i=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:i.detail)||"保存失败")}finally{E.value=!1}}})},H=async l=>{try{await w.approve(l.id),V.success("审核通过"),C()}catch(t){console.error("Failed to approve:",t)}},J=async l=>{try{await w.reject(l.id),V.success("已拒绝"),C()}catch(t){console.error("Failed to reject:",t)}},Q=async l=>{try{await fe.confirm(`确定要删除功能点「${l.name}」吗？`,"删除确认",{type:"warning"}),await w.delete(l.id),V.success("删除成功"),C()}catch(t){t!=="cancel"&&console.error("Failed to delete:",t)}};return ee(async()=>{await R()}),(l,t)=>{const i=_e,r=te,c=ae,p=le,x=me,y=pe,W=ce,Y=oe;return m(),g("div",be,[n("div",Ve,[t[10]||(t[10]=n("div",{class:"header-content"},[n("h1",{class:"page-title"},"功能点管理"),n("p",{class:"page-subtitle"},"管理项目功能点")],-1)),n("div",we,[e(r,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),placeholder:"选择项目",class:"project-select",clearable:"",onChange:C},{default:s(()=>[(m(!0),g(B,null,L($.value,a=>(m(),se(i,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(p,{type:"primary",class:"create-btn",onClick:O,disabled:!u.value},{default:s(()=>[e(c,null,{default:s(()=>[e(_(ne))]),_:1}),t[9]||(t[9]=v(" 新增功能点 ",-1))]),_:1},8,["disabled"])])]),n("div",ke,[n("div",Ce,[(m(!0),g(B,null,L(F.value,a=>{var z;return m(),g("div",{key:a.id,class:"fp-item"},[n("div",Fe,[e(c,null,{default:s(()=>[e(_(I))]),_:1})]),n("div",xe,[n("div",Pe,b(a.name),1),n("div",Ee,[n("span",je,b(A(a.test_type)),1),n("span",{class:N(["meta-tag priority-tag",a.priority])},b((z=a.priority)==null?void 0:z.toUpperCase()),3),a.module?(m(),g("span",he,b(a.module),1)):D("",!0)])]),n("div",{class:N(["fp-status",a.status])},b(S(a.status)),3),n("div",Ue,[e(p,{type:"primary",text:"",size:"small",onClick:U=>X(a)},{default:s(()=>[e(c,null,{default:s(()=>[e(_(ie))]),_:1}),t[11]||(t[11]=v(" 编辑 ",-1))]),_:1},8,["onClick"]),e(p,{type:"success",text:"",size:"small",onClick:U=>H(a),disabled:a.status!=="pending"},{default:s(()=>[e(c,null,{default:s(()=>[e(_(re))]),_:1}),t[12]||(t[12]=v(" 通过 ",-1))]),_:1},8,["onClick","disabled"]),e(p,{type:"warning",text:"",size:"small",onClick:U=>J(a),disabled:a.status!=="pending"},{default:s(()=>[e(c,null,{default:s(()=>[e(_(de))]),_:1}),t[13]||(t[13]=v(" 拒绝 ",-1))]),_:1},8,["onClick","disabled"]),e(p,{type:"danger",text:"",size:"small",onClick:U=>Q(a)},{default:s(()=>[e(c,null,{default:s(()=>[e(_(ue))]),_:1}),t[14]||(t[14]=v(" 删除 ",-1))]),_:1},8,["onClick"])])])}),128)),!P.value&&F.value.length===0?(m(),g("div",$e,[e(c,null,{default:s(()=>[e(_(I))]),_:1}),n("p",null,b(u.value?"暂无功能点":"请先选择项目"),1)])):D("",!0)])]),e(Y,{modelValue:f.value,"onUpdate:modelValue":t[8]||(t[8]=a=>f.value=a),title:k.value?"编辑功能点":"新增功能点",width:"600px"},{footer:s(()=>[e(p,{onClick:t[7]||(t[7]=a=>f.value=!1)},{default:s(()=>[...t[15]||(t[15]=[v("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:G,loading:E.value},{default:s(()=>[...t[16]||(t[16]=[v("确定",-1)])]),_:1},8,["loading"])]),default:s(()=>[e(W,{model:o,"label-width":"100px",rules:M,ref_key:"formRef",ref:j},{default:s(()=>[e(y,{label:"功能点名称",prop:"name"},{default:s(()=>[e(x,{modelValue:o.name,"onUpdate:modelValue":t[1]||(t[1]=a=>o.name=a),placeholder:"请输入功能点名称"},null,8,["modelValue"])]),_:1}),e(y,{label:"描述",prop:"description"},{default:s(()=>[e(x,{modelValue:o.description,"onUpdate:modelValue":t[2]||(t[2]=a=>o.description=a),type:"textarea",rows:3,placeholder:"请输入功能点描述"},null,8,["modelValue"])]),_:1}),e(y,{label:"测试类型",prop:"test_type"},{default:s(()=>[e(r,{modelValue:o.test_type,"onUpdate:modelValue":t[3]||(t[3]=a=>o.test_type=a),placeholder:"请选择测试类型",style:{width:"100%"}},{default:s(()=>[e(i,{label:"功能测试",value:"functional"}),e(i,{label:"性能测试",value:"performance"}),e(i,{label:"安全测试",value:"security"}),e(i,{label:"可靠性测试",value:"reliability"})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"优先级",prop:"priority"},{default:s(()=>[e(r,{modelValue:o.priority,"onUpdate:modelValue":t[4]||(t[4]=a=>o.priority=a),placeholder:"请选择优先级",style:{width:"100%"}},{default:s(()=>[e(i,{label:"P0 - 最高",value:"p0"}),e(i,{label:"P1 - 高",value:"p1"}),e(i,{label:"P2 - 中",value:"p2"}),e(i,{label:"P3 - 低",value:"p3"}),e(i,{label:"P4 - 最低",value:"p4"})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"模块",prop:"module"},{default:s(()=>[e(x,{modelValue:o.module,"onUpdate:modelValue":t[5]||(t[5]=a=>o.module=a),placeholder:"请输入所属模块"},null,8,["modelValue"])]),_:1}),e(y,{label:"验收标准",prop:"acceptance_criteria"},{default:s(()=>[e(x,{modelValue:o.acceptance_criteria,"onUpdate:modelValue":t[6]||(t[6]=a=>o.acceptance_criteria=a),type:"textarea",rows:3,placeholder:"请输入验收标准"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ae=ge(ze,[["__scopeId","data-v-51b3744e"]]);export{Ae as default};
