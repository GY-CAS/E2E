import{d as S,F as q,H as _,b as o,a as t,w as s,I as G,J as H,K as B,L as c,A as J,e as K,x as Q,U as W,V as X,o as v,u as d,y as Z,r as u,i as O,v as y,T as ee,W as te,X as ae,m as se,Y as le,Z as oe,Q as ne,_ as ie,$ as re,a0 as ue,a1 as de,a2 as ce,a3 as $,a4 as pe,a5 as me}from"./index-CILAngGp.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                  */import{p as g}from"./index-BIy6QEMb.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"projects-page"},ve={class:"page-header"},ge={class:"content-card"},ye={class:"projects-list"},ke={class:"project-icon"},we={class:"project-info"},xe={class:"project-name"},Ce={class:"project-meta"},Ve={class:"meta-date"},be={class:"project-desc"},je={class:"project-actions"},$e={key:0,class:"empty-state"},Pe={key:0,class:"pagination-wrapper"},k=10,Ee=S({__name:"Projects",setup(Fe){const P=pe(),w=c(!1),x=c(!1),m=c([]),p=c(!1),f=c(null),C=c(),V=c(1),i=de({name:"",description:""}),D={name:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},I=a=>ce(a).format("YYYY-MM-DD"),M=J(()=>{const a=(V.value-1)*k,e=a+k;return m.value.slice(a,e)}),b=async()=>{w.value=!0;try{const a=await g.list({limit:100});m.value=a}catch(a){console.error("Failed to load projects:",a)}finally{w.value=!1}},E=()=>{f.value=null,i.name="",i.description="",p.value=!0},h=a=>{f.value=a,i.name=a.name,i.description=a.description||"",p.value=!0},T=a=>{P.push(`/documents?project_id=${a.id}`)},U=a=>{P.push(`/testcase/generate?project_id=${a.id}&reset=true`)},Y=async a=>{try{const e=await g.stats(a.id),n=[];e.document_count>0&&n.push(`${e.document_count} 个文档`),e.function_point_count>0&&n.push(`${e.function_point_count} 个功能点`),e.test_case_count>0&&n.push(`${e.test_case_count} 个测试用例`);let r="确定要删除该项目吗？";n.length>0&&(r=`该项目下有 ${n.join("、")}，删除后将无法恢复，确定要删除吗？`),await me.confirm(r,"删除确认",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await g.delete(a.id),$.success("项目删除成功"),b()}catch(e){e!=="cancel"&&console.error("Failed to delete project:",e)}},N=async()=>{C.value&&await C.value.validate(async a=>{if(a){x.value=!0;try{f.value?(await g.update(f.value.id,i),$.success("更新成功")):(await g.create(i),$.success("创建成功")),p.value=!1,b()}catch(e){console.error("Failed to submit:",e)}finally{x.value=!1}}})};return q(()=>{b()}),(a,e)=>{const n=K,r=Q,R=W,F=ue,z=re,A=ie,L=X;return v(),_("div",_e,[o("div",ve,[e[6]||(e[6]=o("div",{class:"header-content"},[o("h1",{class:"page-title"},"项目管理"),o("p",{class:"page-subtitle"},"管理所有测试项目")],-1)),t(r,{type:"primary",class:"create-btn",onClick:E},{default:s(()=>[t(n,null,{default:s(()=>[t(d(Z))]),_:1}),e[5]||(e[5]=u(" 新建项目 ",-1))]),_:1})]),o("div",ge,[o("div",ye,[(v(!0),_(G,null,H(M.value,l=>(v(),_("div",{key:l.id,class:"project-item"},[o("div",ke,[t(n,null,{default:s(()=>[t(d(O))]),_:1})]),o("div",we,[o("div",xe,y(l.name),1),o("div",Ce,[o("span",{class:ee(["meta-tag status-tag",l.status])},y(l.status==="active"?"活跃":"归档"),3),o("span",Ve,[t(n,null,{default:s(()=>[t(d(te))]),_:1}),u(" "+y(I(l.created_at)),1)])])]),o("div",be,y(l.description||"暂无描述"),1),o("div",je,[t(r,{type:"primary",text:"",size:"small",onClick:j=>T(l)},{default:s(()=>[t(n,null,{default:s(()=>[t(d(ae))]),_:1}),e[7]||(e[7]=u(" 查看 ",-1))]),_:1},8,["onClick"]),t(r,{type:"success",text:"",size:"small",onClick:j=>U(l)},{default:s(()=>[t(n,null,{default:s(()=>[t(d(se))]),_:1}),e[8]||(e[8]=u(" 生成用例 ",-1))]),_:1},8,["onClick"]),t(r,{type:"warning",text:"",size:"small",onClick:j=>h(l)},{default:s(()=>[t(n,null,{default:s(()=>[t(d(le))]),_:1}),e[9]||(e[9]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),t(r,{type:"danger",text:"",size:"small",onClick:j=>Y(l)},{default:s(()=>[t(n,null,{default:s(()=>[t(d(oe))]),_:1}),e[10]||(e[10]=u(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128)),!w.value&&m.value.length===0?(v(),_("div",$e,[t(n,null,{default:s(()=>[t(d(ne))]),_:1}),e[12]||(e[12]=o("p",null,"暂无项目",-1)),t(r,{type:"primary",onClick:E},{default:s(()=>[...e[11]||(e[11]=[u("创建第一个项目",-1)])]),_:1})])):B("",!0)]),m.value.length>k?(v(),_("div",Pe,[t(R,{"current-page":V.value,"onUpdate:currentPage":e[0]||(e[0]=l=>V.value=l),"page-size":k,total:m.value.length,layout:"total, prev, pager, next",background:""},null,8,["current-page","total"])])):B("",!0)]),t(L,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),title:f.value?"编辑项目":"新建项目",width:"500px",class:"dark-dialog"},{footer:s(()=>[t(r,{onClick:e[3]||(e[3]=l=>p.value=!1)},{default:s(()=>[...e[13]||(e[13]=[u("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:N,loading:x.value},{default:s(()=>[...e[14]||(e[14]=[u("确定",-1)])]),_:1},8,["loading"])]),default:s(()=>[t(A,{model:i,rules:D,ref_key:"formRef",ref:C,"label-width":"80px"},{default:s(()=>[t(z,{label:"项目名称",prop:"name"},{default:s(()=>[t(F,{modelValue:i.name,"onUpdate:modelValue":e[1]||(e[1]=l=>i.name=l),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(z,{label:"描述",prop:"description"},{default:s(()=>[t(F,{modelValue:i.description,"onUpdate:modelValue":e[2]||(e[2]=l=>i.description=l),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ue=fe(Ee,[["__scopeId","data-v-e82c6ffa"]]);export{Ue as default};
