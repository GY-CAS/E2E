# 端到端测试用例生成应用 - 需求分析文档

## 一、项目概述

### 1.1 项目名称
E2E Test Generator - 端到端测试用例生成平台

### 1.2 项目目标
基于AI多智能体协作的端到端测试用例自动生成平台，支持从需求文档智能解析、测试功能点生成、测试用例生成到测试脚本生成的全流程自动化。

### 1.3 参考项目
- testsigma.com - 端到端测试平台
- https://github.com/zhaoyun-9/testcase-autogenerate - 企业级测试用例生成平台

---

## 二、核心功能需求

### 2.1 多源输入与需求解析

| 功能模块 | 描述 |
|---------|------|
| **多文档上传** | 支持用户需求文档、需求规格说明书、详细设计文档、接口说明、用户手册 |
| **文档格式** | PDF、Word(.docx)、Markdown、TXT、Excel、图片(JPG/PNG) |
| **知识库管理** | 文档向量化存储到Milvus，支持语义检索 |
| **RAG智能解析** | 结合知识库和大模型实现需求智能解析 |

### 2.2 测试功能点生成

| 功能模块 | 描述 |
|---------|------|
| **需求理解** | AI理解并提取关键业务流程、功能模块 |
| **功能点提取** | 自动识别并生成测试功能点清单 |
| **用户交互确认** | 支持用户审核、修改、确认测试功能点 |
| **优先级排序** | P0-P4优先级智能评估和手动调整 |

### 2.3 测试用例生成（Web端专项）

| 测试类型 | 覆盖范围 |
|---------|---------|
| **功能测试** | 前端UI交互、后端API逻辑、数据流转、业务流程 |
| **性能测试** | 页面加载、接口响应、并发处理、资源消耗 |
| **安全测试** | 认证授权、XSS/CSRF防护、SQL注入、敏感数据保护 |
| **可靠性测试** | 异常处理、容错机制、数据恢复、稳定性验证 |

### 2.4 测试脚本生成

| 功能模块 | 描述 |
|---------|------|
| **Python脚本** | 基于pytest + selenium/playwright生成自动化测试脚本 |
| **Java脚本** | 基于TestNG + Selenium生成自动化测试脚本 |
| **脚本模板** | 预置脚本模板，支持自定义模板配置 |
| **脚本管理** | 脚本版本管理、分类存储、导出下载 |

### 2.5 思维导图可视化

| 功能模块 | 描述 |
|---------|------|
| **用例可视化** | 基于AntV G6引擎的思维导图展示 |
| **在线编辑** | 支持节点拖拽、编辑、样式调整 |
| **双向同步** | 测试用例与思维导图双向同步 |

### 2.6 企业级管理功能

| 功能模块 | 描述 |
|---------|------|
| **项目管理** | 多项目支持，项目级数据隔离 |
| **分类体系** | 层级分类管理，支持自定义分类 |
| **标签系统** | 灵活的标签分类和筛选 |
| **统计分析** | 丰富的统计视图和数据分析 |
| **导出功能** | Excel/Word/PDF格式导出 |

---

## 三、技术栈选型

### 3.1 前端技术栈

```
Vue 3.3+ + TypeScript + Vite
UI框架: Element Plus
状态管理: Pinia
路由: Vue Router
HTTP客户端: Axios
图可视化: AntV G6 (思维导图)
代码编辑器: Monaco Editor (脚本编辑)
图表: ECharts
Markdown: markdown-it
```

### 3.2 后端技术栈

```
Web框架: FastAPI 0.104+
ORM: SQLModel (SQLAlchemy 2.0+ + Pydantic V2)
异步支持: asyncio + SSE (Server-Sent Events)
文档解析: python-docx, PyPDF2, openpyxl, python-pptx
任务队列: Celery + Redis (异步任务处理)
数据验证: Pydantic V2
```

### 3.3 AI智能体技术栈

```
LangChain: LLM调用、Prompt模板、文档加载器、RAG检索
LangGraph: 多Agent工作流编排、状态管理
LLM服务: 兼容OpenAI接口 (可配置DeepSeek/Qwen/OpenAI等)
Embedding: 兼容OpenAI接口的向量化服务
```

### 3.4 数据层技术栈

```
关系数据库: PostgreSQL (用例存储、用户管理、文档元数据)
向量数据库: Milvus (文档向量存储、语义检索)
缓存/队列: Redis (会话、任务队列)
文件存储: 本地存储 / MinIO (原始文档存储)
```

---

## 四、系统架构设计

### 4.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        前端层 (Vue 3)                        │
├─────────────────────────────────────────────────────────────┤
│  Vue 3.3+ + TypeScript + Vite                               │
│  UI框架: Element Plus                                        │
│  状态管理: Pinia                                             │
│  图可视化: AntV G6                                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      后端层 (Python)                         │
├─────────────────────────────────────────────────────────────┤
│  Web框架: FastAPI                                            │
│  ORM: SQLModel                                               │
│  异步支持: asyncio + SSE                                      │
│  任务队列: Celery + Redis                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    AI智能体层 (LangChain)                     │
├─────────────────────────────────────────────────────────────┤
│  LangChain: LLM调用、Prompt模板、RAG检索                      │
│  LangGraph: 多Agent工作流编排、状态管理                       │
│  LLM服务: 兼容OpenAI接口                                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据层 (Storage)                         │
├─────────────────────────────────────────────────────────────┤
│  关系数据库: PostgreSQL                                       │
│  向量数据库: Milvus                                           │
│  缓存/队列: Redis                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 多智能体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        LangGraph 工作流编排层                     │
├─────────────────────────────────────────────────────────────────┤
│  StateGraph (状态图)                                             │
│  - 状态管理: documents, function_points, test_cases, scripts    │
│  - 节点编排: 顺序执行、条件分支、循环                             │
│  - 持久化: Memory Saver 支持断点续传                             │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        LangChain Agent 层                        │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐│
│  │ DocumentParser   │  │ RequirementParser│  │ FunctionPointGen ││
│  │ Agent            │  │ Agent            │  │ Agent            ││
│  │ [文档解析]        │  │ [需求理解]        │  │ [功能点生成]      ││
│  └──────────────────┘  └──────────────────┘  └──────────────────┘│
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐│
│  │ TestCaseGen      │  │ ScriptGen        │  │ MindMapGen       ││
│  │ Agent            │  │ Agent            │  │ Agent            ││
│  │ [用例生成]        │  │ [脚本生成]        │  │ [思维导图]        ││
│  └──────────────────┘  └──────────────────┘  └──────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        LangChain Tools 层                        │
├─────────────────────────────────────────────────────────────────┤
│  DocumentTools    VectorStoreTools    TemplateTools             │
│  CodeGenTools     ValidationTools     ExportTools               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 五、AI智能体工作流设计

### 5.1 主工作流

```
用户上传文档
     │
     ▼
┌─────────────────┐
│ 文档解析Agent   │  ← LangChain + LLM
│ - 文件加载      │
│ - 文本分块      │
│ - 向量化存储    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 需求解析Agent   │  ← RAG检索 + LLM
│ - RAG检索       │
│ - 实体提取      │
│ - 关系分析      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 功能点生成Agent │  ← LangGraph编排
│ - 场景推导      │
│ - 分类标记      │
│ - 优先级排序    │
└────────┬────────┘
         │
         ▼
   ┌─────────────┐
   │ 用户确认/修改 │
   └──────┬──────┘
          │
          ▼
┌─────────────────┐
│ 用例生成Agent   │
│ - 功能测试用例  │
│ - 性能测试用例  │
│ - 安全测试用例  │
│ - 可靠性测试用例│
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 脚本生成Agent   │
│ - Python脚本    │
│ - Java脚本      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 思维导图Agent   │
│ - 结构分析      │
│ - 节点生成      │
└────────┬────────┘
         │
         ▼
   输出结果
```

---

## 六、数据模型设计

### 6.1 核心实体

```python
Project (项目)
├── id: UUID
├── name: str
├── description: str
├── status: enum (active/archived)
├── created_at, updated_at
└── relations: documents[], function_points[], test_cases[], test_scripts[]

Document (文档)
├── id: UUID
├── project_id: FK
├── name: str
├── doc_type: enum (requirement/spec/design/api/manual/image)
├── file_path: str
├── status: enum (pending/processing/parsed/failed)
├── parsed_content: text
├── vector_ids[]: JSON
└── relations: project, function_points[]

FunctionPoint (测试功能点)
├── id: UUID
├── project_id: FK
├── document_id: FK
├── name: str
├── description: str
├── test_type: enum (functional/performance/security/reliability)
├── priority: enum (p0/p1/p2/p3/p4)
├── module: str
├── acceptance_criteria: text
├── status: enum (pending/approved/rejected)
└── relations: project, document, test_cases[]

TestCase (测试用例)
├── id: UUID
├── project_id: FK
├── function_point_id: FK
├── title: str
├── description: str
├── test_type: enum (functional/performance/security/reliability)
├── test_category: str (frontend/backend/api/integration)
├── priority: enum (p0/p1/p2/p3/p4)
├── preconditions: text
├── test_steps: JSON [{step_num, action, expected_result, test_data}]
├── expected_results: text
├── test_data: JSON
├── tags[]: JSON
├── status: enum (draft/reviewed/approved)
├── version: int
└── relations: project, function_point, test_scripts[], mind_map_nodes[]

TestScript (测试脚本)
├── id: UUID
├── project_id: FK
├── test_case_id: FK
├── name: str
├── language: enum (python/java)
├── framework: str (pytest/playwright/selenium/testng)
├── content: text
├── file_path: str
├── dependencies: JSON
├── status: enum (draft/reviewed/approved)
├── version: int
└── relations: project, test_case

MindMapNode (思维导图节点)
├── id: UUID
├── project_id: FK
├── test_case_id: FK (可选)
├── parent_id: FK (自关联)
├── text: str
├── node_type: enum (root/module/testcase/step)
├── position: JSON {x, y}
├── style: JSON
└── relations: project, test_case, parent, children[]
```

---

## 七、环境配置设计

### 7.1 .env 配置文件

```env
# ===== 应用配置 =====
APP_NAME=E2E Test Generator
APP_ENV=development
DEBUG=true
SECRET_KEY=your-secret-key-here-change-in-production

# ===== 数据库配置 =====
DATABASE_URL=postgresql://postgres:password@localhost:5432/e2e_testgen
REDIS_URL=redis://localhost:6379/0

# ===== Milvus向量数据库配置 =====
MILVUS_HOST=localhost
MILVUS_PORT=19530
MILVUS_COLLECTION_NAME=doc_vectors

# ===== LLM配置 (兼容OpenAI接口) =====
LLM_PROVIDER=openai
LLM_API_KEY=sk-xxx
LLM_BASE_URL=https://api.openai.com/v1
LLM_MODEL=gpt-4o

# Embedding配置 (兼容OpenAI接口)
EMBEDDING_API_KEY=sk-xxx
EMBEDDING_BASE_URL=https://api.openai.com/v1
EMBEDDING_MODEL=text-embedding-3-small

# DeepSeek配置示例
# LLM_PROVIDER=deepseek
# LLM_API_KEY=sk-xxx
# LLM_BASE_URL=https://api.deepseek.com/v1
# LLM_MODEL=deepseek-chat

# 通义千问配置示例
# LLM_PROVIDER=qwen
# LLM_API_KEY=sk-xxx
# LLM_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
# LLM_MODEL=qwen-plus

# ===== 文件存储配置 =====
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=52428800  # 50MB

# ===== Celery配置 =====
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# ===== 日志配置 =====
LOG_LEVEL=INFO
LOG_FILE=./logs/app.log
```

---

## 八、项目结构设计

```
e2e_project/
├── frontend/                         # Vue前端项目
│   ├── src/
│   │   ├── views/
│   │   │   ├── Dashboard.vue             # 仪表盘
│   │   │   ├── Projects.vue              # 项目管理
│   │   │   ├── Documents.vue             # 文档管理
│   │   │   ├── KnowledgeBase.vue         # 知识库管理
│   │   │   ├── FunctionPoints.vue        # 测试功能点
│   │   │   ├── TestCase/
│   │   │   │   ├── Generate.vue          # 用例生成页面
│   │   │   │   ├── Manage.vue            # 用例管理页面
│   │   │   │   ├── Detail.vue            # 用例详情
│   │   │   │   └── Export.vue            # 导出页面
│   │   │   ├── TestScript/
│   │   │   │   ├── Generate.vue          # 脚本生成页面
│   │   │   │   ├── Manage.vue            # 脚本管理页面
│   │   │   │   └── Editor.vue            # 脚本编辑器
│   │   │   └── MindMap.vue               # 思维导图页面
│   │   ├── components/
│   │   ├── stores/
│   │   ├── api/
│   │   ├── router/
│   │   ├── utils/
│   │   └── types/
│   ├── package.json
│   └── vite.config.ts
│
├── backend/                          # Python后端项目
│   ├── app/
│   │   ├── main.py
│   │   ├── api/endpoints/
│   │   ├── models/
│   │   ├── schemas/
│   │   ├── services/
│   │   └── core/
│   ├── agents/                       # AI智能体模块
│   │   ├── base/
│   │   ├── document/
│   │   ├── requirement/
│   │   ├── function_point/
│   │   ├── testcase/
│   │   ├── script/
│   │   ├── mindmap/
│   │   ├── workflow.py
│   │   ├── tools/
│   │   └── prompts/
│   ├── templates/                    # 脚本模板
│   └── requirements.txt
│
├── uploads/
├── logs/
├── .env
├── .env.example
├── docker-compose.yml
└── README.md
```

---

## 九、开发阶段计划

| 阶段 | 任务 | 交付物 |
|------|------|--------|
| **Phase 1** | 项目初始化 | 项目骨架、Docker环境、.env配置 |
| **Phase 2** | 后端基础框架 | FastAPI项目、数据库模型、基础API |
| **Phase 3** | 文档处理模块 | 文档上传、解析、Milvus向量存储 |
| **Phase 4** | AI智能体模块 | LangChain/LangGraph集成、多Agent工作流 |
| **Phase 5** | 测试用例生成 | 用例生成、思维导图、导出功能 |
| **Phase 6** | 测试脚本生成 | Python/Java脚本生成、模板管理 |
| **Phase 7** | 前端开发 | Vue项目、页面组件、API对接 |
| **Phase 8** | 联调优化 | 功能完善、性能优化、测试验证 |

---

## 十、测试脚本模板示例

### 10.1 Python模板 (pytest + Selenium)

```python
import pytest
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

class TestExample:
    """测试用例描述"""
    
    @pytest.fixture(autouse=True)
    def setup(self):
        self.driver = webdriver.Chrome()
        self.driver.maximize_window()
        self.wait = WebDriverWait(self.driver, 10)
        yield
        self.driver.quit()
    
    def test_example(self):
        """测试步骤描述"""
        self.driver.get("https://example.com")
        element = self.wait.until(
            EC.presence_of_element_located((By.ID, "element_id"))
        )
        assert element.is_displayed()
```

### 10.2 Java模板 (TestNG + Selenium)

```java
import org.testng.annotations.*;
import org.openqa.selenium.*;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.*;

public class TestExample {
    private WebDriver driver;
    private WebDriverWait wait;
    
    @BeforeMethod
    public void setUp() {
        driver = new ChromeDriver();
        driver.manage().window().maximize();
        wait = new WebDriverWait(driver, 10);
    }
    
    @AfterMethod
    public void tearDown() {
        if (driver != null) {
            driver.quit();
        }
    }
    
    @Test
    public void testExample() {
        driver.get("https://example.com");
        WebElement element = wait.until(
            ExpectedConditions.presenceOfElementLocated(By.id("element_id"))
        );
        assert element.isDisplayed();
    }
}
```

---

## 十一、关键技术点

### 11.1 LangGraph 工作流状态管理

```python
class AgentState(TypedDict):
    messages: Annotated[List[BaseMessage], operator.add]
    documents: List[dict]
    parsed_content: dict
    function_points: List[dict]
    test_cases: List[dict]
    test_scripts: List[dict]
    mind_map: dict
    current_stage: str
    errors: List[str]
    user_feedback: str
```

### 11.2 SSE 实时流式传输

```python
from fastapi import FastAPI
from fastapi.responses import StreamingResponse

@app.post("/api/generate/stream")
async def generate_stream(request: GenerateRequest):
    async def event_generator():
        async for event in workflow.astream_events(state):
            yield f"data: {event.json()}\n\n"
    
    return StreamingResponse(
        event_generator(),
        media_type="text/event-stream"
    )
```

### 11.3 RAG 检索增强

```python
from langchain_openai import OpenAIEmbeddings
from pymilvus import MilvusClient

class MilvusVectorStore:
    async def similarity_search(self, query: str, k: int = 5):
        query_vector = await self.embeddings.aembed_query(query)
        results = self.client.search(
            collection_name=self.collection_name,
            data=[query_vector],
            limit=k
        )
        return results
```

---

**文档版本**: v1.0  
**创建日期**: 2026-02-15  
**最后更新**: 2026-02-15
